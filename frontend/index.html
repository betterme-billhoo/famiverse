<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Famiverse Universe</title>
  <style>
    body { margin: 0; overflow: hidden; }
    #infoCard {
      position: absolute;
      top: 20px;
      left: 20px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      display: none;
      z-index: 10;
    }
  </style>
</head>

<body>
  <div id="infoCard"></div>

  <!-- 引入 three.js 和 OrbitControls -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

  <script>
    // 初始化场景
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x000000);

    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.z = 30;

    const renderer = new THREE.WebGLRenderer({antialias: true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // 使用 OrbitControls
    const controls = new THREE.OrbitControls(camera, renderer.domElement);

    // 创建光源
    const light = new THREE.PointLight(0xffffff, 1.2);
    light.position.set(50, 50, 50);
    scene.add(light);
    scene.add(new THREE.AmbientLight(0x404040));
    
    // 创建星空背景
    function createStars() {
      const starsGeometry = new THREE.BufferGeometry();
      
      const starsVertices = [];
      const starsSizes = [];
      const starsOpacities = []; // 用于闪烁效果
      const starsFlickerSpeeds = []; // 闪烁速度
      
      for (let i = 0; i < 10000; i++) {
        const x = (Math.random() - 0.5) * 2000;
        const y = (Math.random() - 0.5) * 2000;
        const z = (Math.random() - 0.5) * 2000;
        starsVertices.push(x, y, z);
        
        // 随机大小 - 有些大，有些小
        const size = Math.random() * 0.3 + 0.05;
        starsSizes.push(size);
        
        // 初始透明度
        starsOpacities.push(Math.random() * 0.5 + 0.5);
        
        // 随机闪烁速度
        starsFlickerSpeeds.push(Math.random() * 0.02 + 0.005);
      }
      
      starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
      starsGeometry.setAttribute('size', new THREE.Float32BufferAttribute(starsSizes, 1));
      
      const starsMaterial = new THREE.PointsMaterial({
        color: 0xffffff,
        sizeAttenuation: true,
        transparent: true,
        vertexColors: false
      });
      
      const starField = new THREE.Points(starsGeometry, starsMaterial);
      scene.add(starField);
      
      return {
        starField,
        opacities: starsOpacities,
        flickerSpeeds: starsFlickerSpeeds,
        sizes: starsSizes
      };
    }
    
    const starsData = createStars();
    const stars = starsData.starField;

    // 星球信息
    const planetsData = [
      { name: "Character", position: [10, 0, 0], color: 0xff6666, info: "Focus on humility, honesty, trustworthiness..." },
      { name: "Wisdom", position: [-10, 0, 0], color: 0x66ccff, info: "Intellectual development, relationships, knowledge..." },
      { name: "Physical Well-being", position: [0, 10, 0], color: 0x66ff66, info: "Physical and mental health, strong body and mind..." },
      { name: "Aesthetics", position: [0, -10, 0], color: 0xffcc66, info: "Perception, creation, and appreciation of beauty..." },
      { name: "Hands-on Practice", position: [0, 0, 10], color: 0xcc99ff, info: "Hands-on experiments, projects, labor, real-world practice..." },
      { name: "Mindfulness", position: [0, 0, -10], color: 0xffffff, info: "Inner peace, personality cultivation, resilience..." }
    ];

    const planets = [];

    // 创建星球
    planetsData.forEach(data => {
      const geometry = new THREE.SphereGeometry(1, 32, 32);
      const material = new THREE.MeshStandardMaterial({ color: data.color });
      const sphere = new THREE.Mesh(geometry, material);
      sphere.position.set(...data.position);
      sphere.userData = { info: data.info, name: data.name };
      scene.add(sphere);
      planets.push(sphere);
    });

    // 创建连线
    for (let i = 0; i < planets.length; i++) {
      for (let j = i + 1; j < planets.length; j++) {
        const material = new THREE.LineBasicMaterial({ color: 0x888888 });
        const points = [
          planets[i].position,
          planets[j].position
        ];
        const geometry = new THREE.BufferGeometry().setFromPoints(points);
        const line = new THREE.Line(geometry, material);
        scene.add(line);
      }
    }

    // 星球自转
    function rotatePlanets() {
      planets.forEach(planet => {
        planet.rotation.y += 0.005;
      });
    }
    
    // 星空微微旋转和闪烁
    function updateStars() {
      stars.rotation.x += 0.0001;
      stars.rotation.y += 0.0001;
      
      // 更新星星闪烁效果
      const sizes = stars.geometry.attributes.size.array;
      
      for (let i = 0; i < sizes.length; i++) {
        // 更新透明度 - 模拟闪烁
        starsData.opacities[i] += Math.sin(Date.now() * starsData.flickerSpeeds[i]) * 0.01;
        
        // 保持透明度在合理范围内
        if (starsData.opacities[i] > 1) starsData.opacities[i] = 1;
        if (starsData.opacities[i] < 0.3) starsData.opacities[i] = 0.3;
        
        // 根据透明度轻微调整大小，使闪烁效果更明显
        sizes[i] = starsData.sizes[i] * starsData.opacities[i];
      }
      
      stars.geometry.attributes.size.needsUpdate = true;
      stars.material.opacity = 0.8 + Math.sin(Date.now() * 0.001) * 0.2;
    }

    // 点击事件
    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();
    const infoCard = document.getElementById('infoCard');

    function onMouseClick(event) {
      mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
      mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

      raycaster.setFromCamera(mouse, camera);
      const intersects = raycaster.intersectObjects(planets);

      if (intersects.length > 0) {
        const planet = intersects[0].object;
        infoCard.style.display = 'block';
        infoCard.innerHTML = `<h3>${planet.userData.name}</h3><p>${planet.userData.info}</p>`;
      }
    }
    window.addEventListener('click', onMouseClick);

    // 动画循环
    function animate() {
      requestAnimationFrame(animate);
      rotatePlanets();
      updateStars();
      controls.update();
      renderer.render(scene, camera);
    }
    animate();

    // 窗口大小自适应
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
